# 积分 (integration.c)

## 题目描述

辛普森积分法是一种用抛物线近似函数曲线来求定积分数值解的方法。把积分区间等分成若干段，对被积函数在每一段上使用[辛普森公式](https://baike.baidu.com/item/%E8%BE%9B%E6%99%AE%E6%A3%AE%E5%85%AC%E5%BC%8F/9255085)：

$\int^b_af(x) \approx \dfrac{4f(\frac{a + b}{2}) + f(a) + f(b)}{6}(b - a)$

，就相当于根据其在每一段的两端和中点处的值近似为抛物线，逐段积分后加起来，即得到原定积分的数值解。

给出一个多项式函数，$f(x) = (a_nx^n + a_{n - 1}x^{n - 1} + ... + a_1x + a_0) ^ p$，其中 $n\leqslant 20$, $a_i$ 是整数，$p\in \{-2, -1, 1, 2\}$。请应用辛普森积分法计算函数在区间 $(a, b)$ 上的定积分数值。允许误差范围为 $\pm 10^{-4}$。

本题要求采用 [Adaptive Simpson's Method](https://en.wikipedia.org/wiki/Adaptive_Simpson%27s_method) 以保证精度。

### 自适应辛普森法[¶](https://oi-wiki.org/math/integral/#_7 "Permanent link")

普通的方法为保证精度在时间方面无疑会受到分段数量的限制，我们应该找一种更加合适的方法。

现在唯一的问题就是如何进行分段。如果段数少了计算误差就大，段数多了时间效率又会低。我们需要找到一个准确度和效率的平衡点。

我们这样考虑：假如有一段图像已经很接近二次函数的话，直接带入公式求积分，得到的值精度就很高了，不需要再继续分割这一段了。

于是我们有了这样一种分割方法：每次判断当前段和二次函数的相似程度，如果足够相似的话就直接代入公式计算，否则将当前段分割成左右两段递归求解。若对于一段积分允许的误差为 $\epsilon$，则分割后的两段误差均不得大于 $\epsilon / 2$ 才能满足要求。

现在就剩下一个问题了：如何判断每一段和二次函数是否相似？

我们把当前段直接代入公式求积分 S，再将当前段从中点分割成两段，把这两段再直接代入公式求积分SL 和 SR。如果当前段的积分和分割成两段后的积分之和相差很小的话 ($|SL + SR - S|\leqslant 15\epsilon$)，就可以认为当前段和二次函数很相似了，不用再递归分割了，直接返回 $SL + SR + (SL + SR - S) / 15$。

## 输入格式

第一行两个整数 n, p。

第二行 n + 1 个整数 $a_0, a_1, a_2, ..., a_n$。

第三行两个实数 a，b 即待积区间。

保证50%的数据，p = 1，这种情况下你可以用原函数计算积分。

保证函数在区间上连续。

保证计算不爆 double。

## 输出格式

一个浮点数，表示积分结果。

## 脚注

样例1的函数为 $f(x) = x^2 + x$.

2为 $f(x) = \dfrac{1}{x}$

## 样例

### 样例输入

2 1
0 1 1
-1 1

### 样例输出

0.666667

### 样例输入

1 -1
0 1
1 2

### 样例输出

0.693147
