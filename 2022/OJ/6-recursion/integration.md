# 积分 (integration.c)

## 题目描述

注意本题允许误差。

辛普森积分法是一种用抛物线近似函数曲线来求定积分数值解的方法。把积分区间等分成若干段，对被积函数在每一段上使用[辛普森公式](https://baike.baidu.com/item/%E8%BE%9B%E6%99%AE%E6%A3%AE%E5%85%AC%E5%BC%8F/9255085)：

$S(a,b) = \int^b_af(x) \approx \dfrac{4f(\frac{a + b}{2}) + f(a) + f(b)}{6}(b - a)$

就相当于根据其在每一段的两端和中点处的值近似为抛物线，逐段积分后加起来，即得到原定积分的数值解。

本题要求采用 [Adaptive Simpson's Method](https://en.wikipedia.org/wiki/Adaptive_Simpson%27s_method) 自适应辛普森法 以保证精度。

（上述**两处链接**均为出题时的参考材料，不需要阅读。）

**请大家仔细阅读下面的步骤，去阅读材料和网上的资料里面找答案可能也能通过本题，但是会花费你大量的时间。**

#### 自适应辛普森法

* 考虑当前在 $(l, r)$ 上对 $f(x)$ 进行积分，因为是数值积分，使用一个精度 $\epsilon$ 表示当前可接受的误差。
* 记 $mid = \frac{l + r}{2}$ ，使用**辛普森公式**求出 $(l, r)$ 的积分数值 $S$ ，$(l, mid)$ 段的积分数值 $SL$ ，$(mid, r)$ 段的积分数值 $SR$ 。
* 若当前段与抛物线足够相似，即满足$|SL + SR - S| \leq 15\epsilon$ 的精度要求，则直接使用 $SL + SR + \frac{SL + SR - S}{15}$ 作为当前段积分的答案。
* 若当前段不满足精度要求，则直接按照 $mid$ 将区间从中拆分为 $(l, mid)$ 和 $(mid, r)$ 两个区间分别进行上述处理并将结果相加。因为减少了区间长度，所以在处理上述两个子区间时需要动态调整 $\epsilon$ ，为简单起见可取 $\epsilon' = \frac{\epsilon}{2}$ 。

给出一个多项式函数，$f(x) = (a_nx^n + a_{n - 1}x^{n - 1} + ... + a_1x + a_0) ^ p$，其中 $n\leqslant 20$, $a_i$ 是整数，$p\in \{-2, -1, 1, 2\}$。请应用辛普森积分法计算函数在区间 $(a, b)$ 上的定积分数值。允许误差范围为 $\pm 10^{-4}$。

## 输入格式

第一行两个整数 $n$, $p$。

第二行 $n + 1$ 个整数 $a_0, a_1, a_2, ..., a_n$。

第三行两个实数 $a$，$b$ 即待积区间。

保证50%的数据，$p = 1$，这种情况下你可以用原函数计算积分。

保证函数在区间上连续。

保证计算不爆 `double` 的范围与精度。

## 输出格式

一个浮点数，表示积分结果。

## 备注

样例1的函数为 $f(x) = x^2 + x$.

2为 $f(x) = \dfrac{1}{x}$

### Hint

`abs` 函数的声明为 `int abs(int)` ，如果你直接调用了 `abs(double)` ，则函数在调用时会将参数强制转换为 `int` 丢失大量精度（小数点后全没了）。

应该使用什么呢？相信大家都知道要去哪里找答案。

## 示例

### 示例输入1

```text
2 1
0 1 1
-1 1
```

### 示例输出1

```text
0.666667
```

### 示例输入2

```text
1 -1
0 1
1 2
```

### 示例输出2

```text
0.693147
```